{"meta":{"title":"Matthew Blog","subtitle":"","description":"","author":"Matthew","url":"http://yoursite.com","root":"/"},"pages":[],"posts":[{"title":"Azkaban-1.搭建Azkaban源代码阅读环境","slug":"Azkaban-1-搭建Azkaban源代码阅读环境","date":"2020-05-23T08:26:45.000Z","updated":"2020-05-23T10:42:41.720Z","comments":true,"path":"2020/05/23/Azkaban-1-搭建Azkaban源代码阅读环境/","link":"","permalink":"http://yoursite.com/2020/05/23/Azkaban-1-%E6%90%AD%E5%BB%BAAzkaban%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E7%8E%AF%E5%A2%83/","excerpt":"","text":"在公司的日常工作中， 经常会用到 Azkaban。作为一种工作流管理系统, 对我来说, 的确有学习的价值。 本文将会使用最新版的Azkaban源代码, 编译并搭建一套可运行调试的系统。开发工具使用的是IDEA, 运行环境是CentOS7。 从github下载源代码截止目前，最新的tag版本是: 3.86.0可以直接点击下载源码: 3.86.0 &lt; !– more –&gt; 编译用IDEA打开, File -&gt; Open… -&gt; 选择已解压的代码目录 -&gt; 点击 OK。此时, IDEA会自动同步一些Gradle项目的配置，稍微等待一会。 为了解决gradle项目下载依赖慢的问题， 我们可以加上阿里云的maven仓库地址。在azkaban根目录下的 build.gradle 中加入下面内容即可: 1maven &#123; url \"http://maven.aliyun.com/nexus/content/groups/public\" &#125; 加入后的效果是这样的: 123456789allprojects &#123; apply plugin: &#39;jacoco&#39; repositories &#123; maven &#123; url &quot;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&quot; &#125; mavenCentral() mavenLocal() &#125;&#125; 注意: 这里需要保留原来的仓库地址, 因为有些依赖阿里云仓库下载不到 配置好之后, 我们就可以执行以下命令编译了: 1./gradlew build -x test 编译成功后, 就有了az-web 和 az-exec 的可运行程序压缩包了。 数据库、表初始化推荐使用 MySQL5.7.x 12345678-- 创建数据库mysql&gt; CREATE DATABASE azkaban;--创建用户, username/password 自定义mysql&gt; CREATE USER 'username'@'%' IDENTIFIED BY 'password';--授权, &lt;username&gt; 改为你自己的用户名 mysql&gt; GRANT SELECT,INSERT,UPDATE,DELETE ON azkaban.* to '&lt;username&gt;'@'%' WITH GRANT OPTION; 调整Mysql Packet Size, 找到MySQL的配置文件,修改max_allowed_packet=1024M 123[mysqld]...max_allowed_packet&#x3D;1024M 重启MySQL 1sudo &#x2F;sbin&#x2F;service mysqld restart 使用初始化sql建表: 12# 位置azkaban-3.86.0\\azkaban-db\\build\\sql\\create-all-sql-0.1.0-SNAPSHOT.sql 运行azkaban执行节点编译后的压缩包路径: azkaban-exec-server/build/distributions/azkaban-exec-server-0.1.0-SNAPSHOT.zip 1.更改配置文件上传 azkaban-exec-server-0.1.0-SNAPSHOT.zip 到 centos 服务器上，解压。修改 azkaban-exec-server/conf/azkaban.properties 配置文件: 123456789101112131415# 数据库信息mysql.port=3306mysql.host=192.168.3.25mysql.database=azkabanmysql.user=rootmysql.password=123456# 执行节点信息executor.port=12321azkaban.use.multiple.executors=trueazkaban.executorselector.filters=StaticRemainingFlowSize,MinimumFreeMemory,CpuStatusazkaban.executorselector.comparator.NumberOfAssignedFlowComparator=1azkaban.executorselector.comparator.Memory=1azkaban.executorselector.comparator.LastDispatched=1azkaban.executorselector.comparator.CpuUsage=1 2.设置远程debug2.1 编辑文件 azkaban-exec-server/bin/internal/internal-start-executor.sh， 增加一个 AZKABAN_OPTS 值 123......AZKABAN_OPTS=\"$AZKABAN_OPTS -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5554\"java $AZKABAN_OPTS $JAVA_LIB_PATH -cp $CLASSPATH azkaban.execapp.AzkabanExecutorServer -conf $conf $@ &amp; 2.2 IDEA中配置点击编辑运行时配置 -&gt; 点击左上角的 + ，选择 Remote 选项。配置如下图:说明: Host: 为az执行节点的IP Port: 为 上面我们配置的那个远程debug端口 Use module classpath: 为az-exec模块的main 点击OK即可, 需要远程服务先启动,才能进行远程debug操作。 3.运行并激活az-exec运行: 12cd azkaban-exec-serverbin/start-exec.sh 激活: 1curl -G &quot;http:&#x2F;&#x2F;192.168.3.25:12321&#x2F;executor?action&#x3D;activate&quot; &amp;&amp; echo 192.168.3.25:12321 为 az执行节点的地址 此时, 可以发现azkaban库 executors 表中已经有执行节点的记录 运行azkaban Web节点编译后的压缩包路径:azkaban-web-server/build/distributions/azkaban-web-server-0.1.0-SNAPSHOT.zip 1.更改配置文件上传 azkaban-web-server-0.1.0-SNAPSHOT.zip 到 centos 服务器上，解压。修改 azkaban-web-server/conf/azkaban.properties 配置文件: 123456# 数据库信息mysql.port=3306mysql.host=192.168.3.25mysql.database=azkabanmysql.user=rootmysql.password=123456 2.设置远程debug2.1 编辑文件 azkaban-web-server/bin/internal/internal-start-web.sh， 增加一个 AZKABAN_OPTS 值 123......AZKABAN_OPTS=\"$AZKABAN_OPTS -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5555\"java $AZKABAN_OPTS $JAVA_LIB_PATH -cp $CLASSPATH azkaban.webapp.AzkabanWebServer -conf $conf $@ &amp; 2.2 IDEA中配置点击编辑运行时配置 -&gt; 点击左上角的 + ，选择 Remote 选项。配置如下图: 3.运行az-web 12cd azkaban-web-serverbin/start-web.sh 4.登录Azkaban默认使用的xml来管理用户。配置文件目录: azkaban-web-server/conf/azkaban-users.xml访问 http://192.168.3.25:8081, 使用azkaban/azkaban 即可登录。 192.168.3.25: 为 az-web的ip 8081: 为az-web的端口 远程调试在 az-web 和 az-exec 都启动之后, 先确保所有端口都能正常访问, 我这儿配置的是 az-exec服务端口: 12321 az-exec远程debug端口: 5554 az-web服务端口: 8091 az-web远程debug端口: 5555 然后在IDEA中运行下图中的这两项即可。在想要看细节的地方打上断点, 就可以愉快玩耍啦。","categories":[],"tags":[{"name":"Azkaban","slug":"Azkaban","permalink":"http://yoursite.com/tags/Azkaban/"},{"name":"调试","slug":"调试","permalink":"http://yoursite.com/tags/%E8%B0%83%E8%AF%95/"},{"name":"IDEA","slug":"IDEA","permalink":"http://yoursite.com/tags/IDEA/"},{"name":"源码阅读","slug":"源码阅读","permalink":"http://yoursite.com/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"}]},{"title":"Hexo Markdown-it 简明语法手册","slug":"hello-world","date":"2016-01-15T12:19:32.000Z","updated":"2020-05-14T16:21:34.070Z","comments":true,"path":"2016/01/15/hello-world/","link":"","permalink":"http://yoursite.com/2016/01/15/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"First TEST\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[{"name":"学习","slug":"学习","permalink":"http://yoursite.com/categories/%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Markdown","slug":"Markdown","permalink":"http://yoursite.com/tags/Markdown/"},{"name":"LaTex","slug":"LaTex","permalink":"http://yoursite.com/tags/LaTex/"},{"name":"教程","slug":"教程","permalink":"http://yoursite.com/tags/%E6%95%99%E7%A8%8B/"}]}],"categories":[{"name":"学习","slug":"学习","permalink":"http://yoursite.com/categories/%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Azkaban","slug":"Azkaban","permalink":"http://yoursite.com/tags/Azkaban/"},{"name":"调试","slug":"调试","permalink":"http://yoursite.com/tags/%E8%B0%83%E8%AF%95/"},{"name":"IDEA","slug":"IDEA","permalink":"http://yoursite.com/tags/IDEA/"},{"name":"源码阅读","slug":"源码阅读","permalink":"http://yoursite.com/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"},{"name":"Markdown","slug":"Markdown","permalink":"http://yoursite.com/tags/Markdown/"},{"name":"LaTex","slug":"LaTex","permalink":"http://yoursite.com/tags/LaTex/"},{"name":"教程","slug":"教程","permalink":"http://yoursite.com/tags/%E6%95%99%E7%A8%8B/"}]}